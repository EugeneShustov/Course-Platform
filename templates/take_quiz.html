{% extends 'base.html' %}
{% block title %}Прохождение теста{% endblock %}

{% block content %}
<h2>{{ quiz.title }}</h2>

{% if messages %}
  <ul>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

{% if already_taken %}
  <div class="quiz-summary" style="margin-bottom:30px; padding:15px; border:1px solid #ccc; border-radius:5px;">
    <h4>Вы уже проходили этот тест</h4>
    <p><strong>Результат:</strong> {{ result.score }}%</p>
    <p style="font-size: 0.9em; color: #666;"><strong>Дата:</strong> {{ result.completed_at|date:"d.m.Y H:i" }}</p>
  </div>

  <h4>Ваши ответы</h4>
  <ul style="list-style: none; padding-left: 0;">
    {% for attempt in result.attempts.all %}
      <li style="margin-bottom:20px; padding:15px; border:1px solid #e3e3e3; border-radius:5px; background-color: #f9f9f9;">
        <p><strong>{{ forloop.counter }}. {{ attempt.question.text }}</strong></p>
        <p>
          <strong>Ваш ответ:</strong>
          <span style="color: {% if attempt.is_correct %}green{% else %}red{% endif %}; font-weight: bold;">
            {{ attempt.selected_answer.text|default:"неправильно" }}
          </span>
        </p>
        {% if not attempt.is_correct and attempt.correct_answer %}
          <p style="color: #555;"><em>Правильный ответ:</em> {{ attempt.correct_answer.text }}</em></p>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  <form method="post" action="{% url 'restart_quiz_for_user' quiz.id %}" style="margin-top: 20px;">
    {% csrf_token %}
    <button type="submit" class="btn btn-warning">Пройти тест снова</button>
  </form>

{% else %}
  <form method="post">
    {% csrf_token %}
    {% for question in quiz.questions.all %}
      <div class="question-block" style="margin-bottom: 30px; padding:15px; border:1px solid #e3e3e3; border-radius:5px;">
        <p><strong>{{ forloop.counter }}. {{ question.text }}</strong></p>
        <input type="text" name="q{{ question.id }}" placeholder="Ваш ответ" style="width: 100%; padding: 8px; margin-top: 5px;" required>
      </div>
    {% endfor %}
    <button type="submit" class="btn-link btn-success" style="margin-top:20px;">Отправить</button>
  </form>
{% endif %}
{% endblock %}




